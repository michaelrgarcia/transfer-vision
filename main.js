/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={};function t(e,t,n){const o=document.createElement("option");return o.textContent=e,o.value=e,t&&n&&o.setAttribute(`data-${n}`,t),o}function n(e){const t=document.createElement("option");return t.textContent=`Select a ${e}`,t.value="",t.disabled=!0,t.selected=!0,t}function o(){const e=document.querySelector(".articulations"),t=document.createElement("div");return t.classList.add("class-list"),t.style.display="flex",t.style.opacity="1",e.append(t),t}function r(e,t,n){const o=document.createElement("a");o.href=n,o.target="_blank",o.textContent=t,e.append(o)}function c(e,t){const n=document.createElement("p");n.textContent=e,t.appendChild(n)}function a(e,t){const n=document.createElement("p");n.classList.add("connector"),n.textContent=e,t.appendChild(n)}function s(e,t){const n=document.createElement("p");n.classList.add("conjunction"),n.textContent=e,t.appendChild(n)}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var o=n.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=o[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.p,e.p,e.p,e.p,e.p,e.p;const i=e=>{const t=(e=e.trim()).match("[0-9.]+");let n,o="ms";const r=t?t[0]:"";return r&&(o=e.split(r)[1],n=Number(r)),{num:n,unit:o}},l=function(e){const t=function(e){const t=t=>{return window.getComputedStyle(e).getPropertyValue(t)||e.style[(n=t,n.replace(/-([a-z])/g,(e=>e[1].toUpperCase())))];var n},n=t("transition-delay")||"0ms",o=t("transition-duration")||"0ms",r=Array.isArray(o)?o:[o],c=Array.isArray(n)?n:[n];let a,s=0;return r.push.apply(r,c),r.forEach((e=>{e.split(",").forEach((e=>{e=(e=>{const t=i(e),n=t?t.num:void 0;if(!n)return"";let o=n;return"s"===e.replace(n+"","")&&(o=1e3*n),o+"ms"})(e),a=i(e),a.num&&a.num>s&&(s=a.num)}))})),s}(e);return new Promise((n=>{t>0?setTimeout((()=>{n(e)}),t):n(e)}))};const u=document.querySelector("dialog"),d=document.querySelector("form"),y=document.querySelector("img.loading-gif"),p=document.querySelector(".results"),f=document.querySelector(".loading-container"),m=document.querySelector(".back"),h=document.querySelector(".cid-section");function g(){u.showModal(),u.style.opacity=1}function w(e){const t=e,n=t.querySelector("select"),o=t.querySelectorAll(":not(.loading)");n&&(n.disabled=!0),o.forEach((e=>{e.setAttribute("aria-disabled","true")}))}function b(e){const t=e,n=t.querySelector("select"),o=t.querySelectorAll(":not(.loading)");n&&(n.disabled=!1),o.forEach((e=>{e.setAttribute("aria-disabled","false")}))}function S(e,t){w(e),function(e){const t=e;t.style.opacity=1,t.style.display="block"}(t)}function v(e,t){b(e),function(e){const t=e;t.style.opacity=0,t.style.display="none"}(t)}function C(){f.style.opacity=0,l(f).then((()=>{f.style.display="none"}))}function x(){l(f).then((()=>{h.style.opacity=1})),h.style.display="flex"}const q="https://cs46plizg2.execute-api.us-east-2.amazonaws.com";async function E(e){let t;try{const n=await fetch(e),o=await n.json();t=Object.values(o)}catch(e){console.error("error fetching school data:",e)}return t}async function A(e,t,o){const r=e.parentNode,c=r.querySelector(".loading");S(r,c);const a=await async function(e,t){let n;try{const o=await async function(e,t){let n;try{const o=`${q}/74/6/${e}/${t}/lower-divs`,r=await fetch(o),c=await r.json();n=Object.values(c)}catch(e){console.log("error fetching lower divs:",e)}return n}(e,t);n=o}catch(e){console.error("error retrieving lower divs:",e)}return n}(t,o),s=e,i=n("class");s.replaceChildren(),s.appendChild(i),a.forEach(((e,t)=>{const n=function(e,t,n){const o=document.createElement("option");return o.textContent=e,o.value=t,o.setAttribute("data-id",n),o}(function(e){let t="";return"object"!=typeof e||Array.isArray(e)?Array.isArray(e)&&(t=function(e){const t=function(e){const t=e;if("object"!=typeof t||Array.isArray(t)){if(Array.isArray(t))for(let e=0;e<t.length;)t[e].seriesId&&t.splice(e,1),e+=1}else delete t.courseId;return t}(e.slice());let n="";return t.forEach(((e,o)=>{let r;const c=e;if("object"==typeof c){const{prefix:e,courseNumber:t}=c;n+=`${e} ${t}`}else"string"==typeof c&&(r=c.toLowerCase(),n+=r);o<t.length-1&&(n+=" ")})),n}(e)):t=`${e.prefix} ${e.courseNumber} - ${e.courseTitle}`,t}(e),t,function(e){let t;if("object"!=typeof e||Array.isArray(e)){if(Array.isArray(e))for(let n=0;n<e.length;){const o=e[n];o.seriesId&&(t=o.seriesId),n+=1}}else t=e.courseId;return t}(e));s.appendChild(n)})),v(r,c)}function $(e,t){for(let n=0;n<e.length;){const o=e[n];Array.isArray(o)?$(o,t):"string"==typeof o?"and"===o.toLowerCase()?a(o,t):"or"===o.toLowerCase()&&s(o,t):o.courseNumber&&o.courseTitle&&o.prefix&&c(`${o.prefix} ${o.courseNumber} - ${o.courseTitle}`,t),n+=1}}function j(e){if(e&&e.result){const{result:t}=e,n=[];let c="",a="";for(let e=0;e<t.length;){const s=t[e];if(s.ccName?c=s.ccName:s.agreementLink?a=s.agreementLink:n.push(s),c&&a){const e=o();r(e,c,a),$(n,e)}e+=1}}}async function k(e,t,n,o,r=[]){let c;if(0===e.length)return r;c=e.length<29?e.splice(0,e.length-1):e.splice(0,29);try{const a=await async function(e,t,n,o){let r;try{const c=JSON.stringify(e),a=`https://nxumffe33mx27f7njbxyq4qwwi0birlz.lambda-url.us-east-2.on.aws/?courseId=${n}`,s=await fetch(a,{body:c,method:"POST",headers:{"Content-Type":"application/json",Connection:"keep-alive"},signal:t});r=await async function(e,t){const n=e.getReader(),o=new TextDecoder("utf-8"),r=[];let c="";for(;;){const{value:e,done:a}=await n.read();if(a)break;c+=o.decode(e,{stream:!0});let s=c.indexOf("\n");for(;-1!==s;){const e=c.slice(0,s);c=c.slice(s+1);try{const n=JSON.parse(e);n.result&&(j(n),r.push(n)),t(1)}catch(e){console.error(`error parsing articulation: ${e}`)}s=c.indexOf("\n")}}return r}(s.body,o)}catch(e){console.error(`error processing stream: ${e}`)}return r}(c,t,n,o);return r.push(...a),await k(e,t,n,o,r)}catch(e){"AbortError"===e.name?console.log("aborted request"):console.error("error processing chunk:",e)}}function N(e,t,n){const o=e;for(let e=0;e<o.length;)j(o[e]),e+=1;n(t),C(),x()}async function L(e,t){const n=e.slice(),o=new AbortController,{signal:r,isAborted:c}=function(e){const t=document.querySelector(".back");let n=!1;return t.addEventListener("click",(()=>{n=!0,function(e){e.abort(),h.style.opacity=0,l(h).then((()=>{h.style.display="none"})),p.style.opacity="0",l(p).then((()=>{p.style.display="none"})),m.style.opacity=0,l(m).then((async()=>{m.style.display="none"})),l(p).then((()=>{d.style.opacity=1})),l(d).then((()=>{d.style.display="flex"})),function(){const e=document.querySelector(".results"),t=document.querySelector(".progress-tracker"),n=document.querySelector(".selected-class"),o=document.querySelector(".articulations"),r=document.querySelector(".cids > input");l(e).then((()=>{o.replaceChildren(),t.textContent="",n.textContent="",r.checked=!1}))}()}(e)})),{signal:e.signal,isAborted:n}}(o),a=function(e){let t=0;return n=>{var o,r;t+=n,o=t,r=e,document.querySelector(".progress-tracker").textContent=`${o} out of ${r} colleges searched`}}(e.length);let s;window.addEventListener("beforeunload",(()=>o.abort())),l(d).then((()=>{p.style.opacity=1,f.style.opacity=1,f.style.display="flex",m.style.opacity=1,m.style.display="block"})),p.style.display="flex",a(0);try{s=await async function(e,t,n){try{const o=await fetch(`https://7bd2zfvix4.execute-api.us-east-2.amazonaws.com/transition1/articulations/get-course/${e}`);if(200===o.status){const e=await o.json();return N(e,t,n),e}if(204===o.status)return console.log("restarting incomplete caching job..."),!1;if(206===o.status)return C(),document.querySelector("dialog").querySelector("p").textContent="Data may be processing. Try again shortly.",g(),!0}catch(e){console.error("error getting class from db",e)}return!1}(t,e.length,a),s||(s=await k(n,r,t,a),C(),c||await async function(e,t){if(t){!function(){const e=document.querySelector(".articulations"),t=document.querySelectorAll(".class-list"),n=Array.from(t);0===t.length?function(e){const t=document.createElement("p");t.classList.add("no-articulations"),t.textContent="No articulations found.",e.appendChild(t),t.style.opacity=1}(e):(n.sort(((e,t)=>{const n=e.querySelector("button"),o=t.querySelector("button");return n&&o?n.textContent.localeCompare(o.textContent):0})),n.forEach((t=>{e.appendChild(t)})))}();try{await fetch("https://pjep6oksdi.execute-api.us-east-2.amazonaws.com/complete-cache",{body:JSON.stringify({courseId:e}),method:"POST",headers:{"Content-Type":"application/json"}}),x()}catch(e){console.error(`error finalizing cache job: ${e}`)}}}(t,s))}catch(e){"AbortError"===e.name?console.log("requests aborted due to page unload"):console.error("error processing requests",e)}finally{window.removeEventListener("beforeunload",(()=>o.abort()))}return{articulations:s,updateProgress:a}}const I=document.querySelector(".cids > input");function T(e){for(let t=0;t<e.length;){const n=e[t];if(n.result&&T(n.result))return!0;if(Array.isArray(n)&&T(n))return!0;if(n&&n.prefix&&n.courseNumber&&n.courseTitle&&n.cid)return!0;t+=1}return!1}async function O(e,t,n,o){let r=t;if(I.checked)if(T(r))console.log("i got cids");else{const t=await async function(e,t){const n=`https://7bd2zfvix4.execute-api.us-east-2.amazonaws.com/transition1/articulations/get-cids/${e}`,o=await fetch(n,{body:JSON.stringify(t),method:"POST",headers:{"Content-Type":"application/json"}});let r;return 200===o.status&&(r=await o.json()),r}(e,r);document.querySelector(".articulations").replaceChildren(),N(t,n,o),r=t}else console.log("hello i hide cids")}function z(e){I.removeEventListener("change",e)}const P=[document.getElementById("four-year"),document.getElementById("major"),document.getElementById("class")],B=P[0],D=P[1],J=P[2],M=document.querySelector(".submit"),K=document.querySelector("dialog"),R=document.querySelector(".close-dialog");document.addEventListener("DOMContentLoaded",(async()=>{for(let e=1;e<P.length;)P[e].parentNode&&(w(P[e].parentNode),e+=1);w(M.parentNode),async function(e){const o=e.parentNode,r=o.querySelector(".loading");g(),S(o,r);const c=await async function(){let e;try{const t=`${q}/four-years`;e=await E(t)}catch(e){console.error("error retrieving four years:",e)}return e}(),a=e,s=n("school");a.appendChild(s),c.forEach((e=>{if(e.id<200){const n=t(e.name,e.id,"sending");a.appendChild(n)}})),u.style.opacity=0,u.close(),v(o,r)}(B),await async function(){l(d).then((async()=>{await async function(e){const t=e,n=await fetch("https://api.giphy.com/v1/gifs/translate?api_key=uldN0xaiyhNfeuN7QN98ROsslA7JpaDG&s=loading",{mode:"cors"}),o=await n.json();try{o&&(t.src=o.data.images.original.url)}catch(e){console.log(e)}}(y),y.style.display="block",y.style.opacity=1}))}(),localStorage.removeItem("cacheTimestamp"),localStorage.removeItem("fourYears"),localStorage.removeItem("communityColleges")})),B.addEventListener("input",(()=>{const e=B.options[B.selectedIndex].dataset.sending;(async function(e,o){const r=e.parentElement,c=r.querySelector(".loading");S(r,c);const a=await async function(e){let t;try{const n=`${q}/major-data/${e}/74`,o=await fetch(n),r=await o.json();t=Object.values(r)}catch(t){console.error(`Error fetching majors for ${e}:`,t)}return t}(o),s=e,i=n("major");s.replaceChildren(),s.appendChild(i),a.forEach((e=>{const n=t(e.major,e.key,"key");s.appendChild(n)})),v(r,c)})(D,e),D.replaceChildren(),J.replaceChildren(),w(J.parentNode),w(M.parentNode)})),D.addEventListener("input",(()=>{const e=B.options[B.selectedIndex].dataset.sending,t=D.options[D.selectedIndex],{key:n}=t.dataset;J.replaceChildren(),A(J,e,n),w(M.parentNode)})),J.addEventListener("change",(()=>{b(M.parentNode)})),M.addEventListener("click",(async e=>{const t=B.options[B.selectedIndex].dataset.sending,n=D.options[D.selectedIndex].dataset.key;if(w(M.parentNode),J.value){const e=await async function(e,t){const n=[],o=await async function(){let e;try{const t=`${q}/community-colleges`;e=await E(t)}catch(e){console.error("error retrieving community colleges:",e)}return e}(),r=e,c=t;return o.forEach((e=>{if(e.id){const t=e.id,o=`https://assist.org/api/articulation/Agreements?Key=74/${t}/to/${r}/Major/${c}`,a=`https://assist.org/transfer/results?year=74&institution=${t}&agreement=${r}&agreementType=to&view=agreement&viewBy=major&viewSendingAgreements=false&viewByKey=74/${t}/to/${r}/Major/${c}`;n.push({link:o,agreementLink:a})}})),n}(t,n),r=J.options[J.selectedIndex],c=r.dataset.id;if(d.style.opacity=0,l(d).then((()=>{d.style.display="none"})),r){o=r.textContent,document.querySelector(".selected-class").textContent=`Articulations for: ${o}`;const t=await L(e,c),{articulations:n,updateProgress:a}=t,s=function(e,t,n,o){const r=()=>O(e,t,n,o);return I.addEventListener("change",r),r}(c,n,e.length,a);!function(e,t,n){const o=document.querySelector(".back"),r=document.querySelector(".submit");function c(){e(r.parentNode),t(n),function(e){document.querySelector(".back").removeEventListener("click",e)}(c)}o.addEventListener("click",c)}(b,z,s)}}var o;e.preventDefault()})),R.addEventListener("click",(()=>{K.close()}))})();